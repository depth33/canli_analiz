<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Canlı Analiz</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background:#f7f7f7; }
    h1 { margin-bottom: 16px; }
    .row { margin: 12px 0 20px; }
    input { padding: 10px; font-size: 16px; width: 260px; max-width: 80vw; }
    button { padding: 10px 14px; font-size: 16px; margin-left: 6px; cursor: pointer; }
    #result { max-width: 900px; margin: 0 auto; text-align: left; }
    .match-card { background:#fff; border-radius:10px; padding:16px; margin:12px 0; box-shadow:0 2px 8px rgba(0,0,0,.08); }
    .muted { color:#666; font-size: 13px; }
  </style>
</head>
<body>
  <h1>Takıma Göre Canlı Maç Arama</h1>

  <div class="row">
    <input type="text" id="teamInput" placeholder="Takım adı girin... (örn: Galatasaray)">
    <button id="searchBtn">Ara</button>
    <button id="listBtn">Canlıları Listele</button>
  </div>

  <div id="result" class="muted">Takım adını yazıp “Ara”ya basın ya da “Canlıları Listele”ye tıklayın.</div>

  <script>
    const API_BASE = "https://canli-analiz-1-59mx.onrender.com";

    async function searchMatch() {
      const team = document.getElementById("teamInput").value.trim();
      const box  = document.getElementById("result");
      if (!team) { box.innerHTML = "<p>Lütfen bir takım adı girin.</p>"; return; }

      box.innerHTML = "<p>⏳ Yükleniyor...</p>";
      try {
        const res = await fetch(`${API_BASE}/match-by-team?team=${encodeURIComponent(team)}`);
        const data = await res.json();

        if (data.error === "rate_limited") {
          box.innerHTML = `<p>⚠️ API limiti aşıldı. Biraz sonra tekrar deneyin.</p>`;
          return;
        }
        if (data.error) { box.innerHTML = `<p>❌ Hata: ${data.error}</p>`; return; }
        if (data.message) { box.innerHTML = `<p>${data.message}</p>`; return; }
        if (!data.results || data.results.length === 0) { box.innerHTML = "<p>Sonuç bulunamadı.</p>"; return; }

        box.innerHTML = data.results.map(m => `
          <div class="match-card">
            <h2>${m.home} 🆚 ${m.away}</h2>
            <p><b>Lig:</b> ${m.league} ${m.country ? "(" + m.country + ")" : ""}</p>
            <p><b>Durum:</b> ${m.status} ${m.minute != null ? "(" + m.minute + ". dk)" : ""}</p>
            <p><b>Skor:</b> ${m.score}</p>
            ${m.fixture_id ? `<p class="muted"><b>Fixture ID:</b> ${m.fixture_id}</p>` : ""}
            <p class="muted">kaynak: ${data.source || "-"}</p>
          </div>
        `).join("");
      } catch (e) {
        box.innerHTML = `<p>❌ Bağlantı hatası: ${e.message}</p>`;
      }
    }

    async function listLive() {
      const box = document.getElementById("result");
      box.innerHTML = "<p>⏳ Yükleniyor...</p>";
      try {
        const res = await fetch(`${API_BASE}/list-live`);
        const data = await res.json();

        if (data.error === "rate_limited") {
          box.innerHTML = `<p>⚠️ API limiti aşıldı. Biraz sonra tekrar deneyin.</p>`;
          return;
        }
        if (data.error) { box.innerHTML = `<p>❌ Hata: ${data.error}</p>`; return; }

        if (!data.matches || data.matches.length === 0) {
          box.innerHTML = "<p>Şu anda canlı maç bulunmuyor.</p>";
          return;
        }

        box.innerHTML = `
          <p class="muted">Toplam: ${data.count} • kaynak: ${data.source}</p>
          ${data.matches.map(m => `
            <div class="match-card">
              <h2>${m.home} 🆚 ${m.away}</h2>
              <p><b>Lig:</b> ${m.league} ${m.country ? "(" + m.country + ")" : ""}</p>
              <p><b>Durum:</b> ${m.status} ${m.minute != null ? "(" + m.minute + ". dk)" : ""}</p>
              <p><b>Skor:</b> ${m.score}</p>
              <p class="muted">fixture_id: ${m.fixture_id} • home_norm: ${m.tokens.home_norm} • away_norm: ${m.tokens.away_norm}</p>
            </div>
          `).join("")}
        `;
      } catch (e) {
        box.innerHTML = `<p>❌ Bağlantı hatası: ${e.message}</p>`;
      }
    }

    document.getElementById("searchBtn").addEventListener("click", searchMatch);
    document.getElementById("listBtn").addEventListener("click", listLive);
    document.getElementById("teamInput").addEventListener("keydown", (e) => {
      if (e.key === "Enter") searchMatch();
    });
  </script>
</body>
</html>
